.\" $ReOpenLDAP$
.\" Copyright 1992-2018 ReOpenLDAP AUTHORS: please see AUTHORS file.
.\" All rights reserved.
.\"
.\" This file is part of ReOpenLDAP.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted only as authorized by the OpenLDAP
.\" Public License.
.\"
.\" A copy of this license is available in the file LICENSE in the
.\" top-level directory of the distribution or, alternatively, at
.\" <http://www.OpenLDAP.org/license.html>.

.TH SLAPD 8C "@RELEASE_DATE@" "ReOpenLDAP @VERSION@"

.SH НАЗВАНИЕ
slapd \- автономный демон LDAP

.SH СИНТАКСИС
[\c
.BR \-4 | \-6 ]
[\c
.BR \-T \ { acl \||\| a [ dd ]\||\| auth \||\| c [ at ]\||\|
.BR d [ n ]\||\| i [ ndex ]\||\| p [ asswd ]\||\| s [ chema ]\||\| t [ est ]}]
[\c
.BI \-d \ debug-level\fR]
[\c
.BI \-f \ slapd-config-file\fR]
[\c
.BI \-F \ slapd-config-directory\fR]
[\c
.BI \-h \ URLs\fR]
[\c
.BI \-n \ service-name\fR]
[\c
.BI \-s \ syslog-level\fR]
[\c
.BI \-l \ syslog-local-user\fR]
[\c
.BI \-o \ option\fR[ = value\fR]]
[\c
.BI \-r \ directory\fR]
[\c
.BI \-u \ user\fR]
[\c
.BI \-g \ group\fR]
[\c
.BI \-c \ cookie\fR]

.SH ОПИСАНИЕ
.LP
.BR slapd \ \-
автономный демон LDAP. Он ожидает подсоединений LDAP на портах
с любым номером (по умолчанию \fB389\fP), выдавая ответ на операции
LDAP, получаемые им по этим соединениям. Обычно
.B slapd
вызывается во время загрузки, как правило из
.BR  /etc/rc.local .
После запуска
.B slapd
обычно производит ответвление и отсоединяется от терминала, из которого был запущен.
Если это настроено в конфигурационном файле (или конфигурационной директории),
процесс
.B slapd
выведет свой идентификатор (смотрите
.BR getpid (2))
в файл
.BR .pid ,
а также указываемые при вызове параметры командной строки в файл
.B .args
(смотрите
.BR slapd.conf (5)).
Если при вызове был указан флаг
.BR \-d ,
даже со значением 0 (ноль),
.B slapd
не будет производить ответвления и отсоединяться от терминала, из которого запущен.
.LP
Дополнительные детали по
.B slapd
смотрите в "Руководстве администратора OpenLDAP".
.SH ПАРАМЕТРЫ
.TP
.B \-4
Ожидать соединений только на адресах IPv4.
.TP
.B \-6
Ожидать соединений только на адресах IPv6.
.TP
.BI \-T \ tool
Запуск в режиме инструмента (утилиты). Значение \fItool\fP определяет, в качестве какой утилиты будет произведён запуск:
.IR slapadd ,
.IR slapcat ,
.IR slapdn ,
.IR slapindex ,
.IR slappasswd ,
.I slapschema
или
.I slaptest
(\fIslapacl\fP и \fIslapauth\fP требуют указания значения параметра в виде \fBacl\fP и \fBauth\fP,
поскольку значение \fBa\fP зарезервировано для
.IR slapadd ).
Если этот параметр используется, он должен быть указан первым;
все остальные параметры будут интерпретироваться соответствующей
slap-утилитой, как описано в её man-странице.
Отметим, что эти программы-утилиты, как правило, представляют собой символические ссылки на
.BR slapd .
Данный параметр предназначен для ситуаций, когда символические ссылки
не поддерживаются или их невозможно использовать.
.TP
.BI \-d \ debug-level
Устанавливает уровень отладки в указанный
.IR debug-level .
Если указан этот параметр, даже cо значением 0 (ноль),
.B slapd
не будет производить ответвления или отсоединяться от терминала, из которого запущен.
Некоторые общие операции и сообщения о состоянии выводятся при любом значении \fIdebug-level\fP.
\fIdebug-level\fP воспринимается как строка битов, где каждый бит соответствует
отладочной информации различного рода. Подробнее смотрите в <ldap_log.h>.
В качестве значения этого параметра может быть указан разделённый запятыми массив читабельных имён уровней отладки,
позволяющий определить вывод соответствующей отладочной информации.
Поддерживаются все имена, распознаваемые директивой \fIloglevel\fP,
описанной в \fBslapd.conf\fP(5).
Если в качестве \fIdebug-level\fP указан \fB?\fP, выводится список установленных уровней отладки
и slapd завершает работу.

Помните, что при включении уровня журналирования packets будут выводиться пакеты,
содержащие пароли подсоединения, так что если журнал перенаправляется в файл,
то этот файл должен быть защищён от прочтения.
.TP
.BI \-s \ syslog-level
Данный параметр сообщает
.BR slapd ,
какого уровня отладочные сообщения следует журналировать средствами
.BR syslog (8).
В качестве \fIsyslog-level\fP может быть установлено любое значение или комбинация значений,
допустимая в параметре \fB\-d\fP.
slapd отправляет на регистрацию все сообщения выбранного уровня \fIsyslog-level\fP
с уровнем важности
.BR syslog (3)
\fBDEBUG\fP в канал, определённый параметром \fB\-l\fP.
.TP
.BI \-n \ service-name
Определяет имя службы для журналирования и других целей. По умолчанию
соответствует базовому имени в argv[0], то есть "slapd".
.TP
.BI \-l \ syslog-local-user
Определяет пользовательский канал для
.BR syslog (8).
Значение может быть от
.BR LOCAL0 ,
до
.BR LOCAL7 ,
а также
.B USER
и
.BR DAEMON .
По умолчанию -
.BR LOCAL4 .
Однако, этот параметр разрешено применять только в системах, поддерживающих
пользовательские каналы в
.BR syslog (8).
Журналирование в syslog(8) происходит с уровнем важности "DEBUG".
.TP
.BI \-f \ slapd-config-file
Определяет конфигурационный файл slapd. По умолчанию
.BR @SYSCONFDIR@/slapd.conf .
.TP
.BI \-F \ slapd-config-directory
Определяет конфигурационную директорию slapd. По умолчанию
.BR @SYSCONFDIR@/slapd.d .
Если указаны сразу и
.B \-f
и
.BR \-F ,
конфигурационный файл будет прочтён, переконвертирован в формат
конфигурационной директории и записан в указанную директорию.
Если не указан ни один из этих параметров, slapd
попытается прочитать конфигурационную директорию по умолчанию,
а затем использовать конфигурационный файл по умолчанию.
Если существует конфигурационная директория в правильном формате,
то конфигурационный файл игнорируется. Такое поведение соблюдается всеми
slap\-утилитами, использующими эти параметры командной строки.
.TP
.BI \-h \ URLlist
.B slapd
по умолчанию будет обслуживать
.B ldap:///
(LDAP по TCP на всех интерфейсах на порту LDAP по умолчанию). То есть,
будет обслуживать подсоединения на INADDR_ANY и порту \fB389\fP.
Параметр
.B \-h
может использоваться, чтобы указать список LDAP URL (и URL с другими схемами), который требуется обслуживать.
Например, если slapd передано
.BR "\-h \(dqldap://127.0.0.1:9009/ ldaps:/// ldapi:///\(dq" ,
он будет ожидать соединения LDAP на 127.0.0.1:9009, LDAP поверх TLS на 0.0.0.0:636,
а также LDAP поверх IPC (доменные сокеты Unix). Адрес хоста 0.0.0.0 представляет собой
INADDR_ANY (любой интерфейс). В качестве значения параметра
ожидается разделённый пробельными символами список URL. Схемы URL должны быть
LDAP, LDAPS или LDAPI, поддержка последних двух схем зависит от параметров конфигурации.
В общем случае URL не должны содержать DN или других
дополнительных параметров (за исключением обсуждаемых ниже).
Хосты могут быть указаны по имени или адресами в форматах IPv4 и IPv6.
Если указывается порт, он должен быть приведён в виде числового номера.
Порт по умолчанию для ldap:// \- \fB389\fP, для ldaps:// \- \fB636\fP.

Для LDAP поверх IPC в качестве
.B имени хоста
в URL указывается имя сокета, а указания
.B порта
не требуется, более того, не разрешается; обратите внимание,
что символ разделителя директорий в имени сокета должен быть
закодирован в формате URL, как и все остальные символы,
являющиеся специальными для URL; таким образом, сокет

        @LOCALSTATEDIR@/ldapi

должен быть указан как

        ldapi://%2Fusr%2Flocal%2Fvar%2Fldapi

Расположение IPC-сокета по умолчанию - @RUNSTATEDIR@/ldapi.

Разрешения на соединения обозначаются конструкциями
"x\-mod=\-rwxrwxrwx", "x\-mod=0777" или "x\-mod=777", где любой символ в сочетании
"rwx" может быть заменён на "\-" для запрета соответствующего разрешения, а символы
на месте "7" могут быть любой допустимой восьмеричной цифрой в соответствии с chmod(1).
Открываемые соединения могут воспользоваться расширением "x\-mod"
для реализации грубых ограничений на операции, например, разрешить операции чтения
("r", применяющееся для операций search и compare), операции записи
("w", применяющееся для операций add, delete, modify и modrdn), и операции исполнения
("x", означающее, что требуется операция bind).
Разрешения, определяемые для "пользователя", применяются к пользователям, прошедшим аутентификацию,
а определяемые для "остальных" - к анонимным пользователям; разрешения для "группы" игнорируются.
Например, "ldap:///????x\-mod=\-rw\-\-\-\-\-\-\-" означает, что операции чтения и записи разрешены
только соединениям, в которых пользователи прошли аутентификацию,
и для всех операций требуется подсоединение.
Данное свойство является экспериментальным и его необходимо явно указывать во время конфигурации.
.TP
.BI \-r \ directory
Определяет директорию, которая станет корневой. slapd изменит текущую рабочую директорию
на указанную директорию, а затем выполнит в неё
.BR chroot (2).
Это осуществляется после открытия портов на прослушивание, но до чтения
каких-либо конфигурационных файлов и инициализации каких-либо механизмов манипуляции данными.
Если этот параметр применяется в качестве механизма безопасности, его следует использовать
совместно с параметрами
.B \-u
и
.BR \-g .
.TP
.BI \-u \ user
.B slapd
будет запущен с правами пользователя, указанного именем или идентификатором, и
к нему будет применён список доступа дополнительных групп этого пользователя согласно
initgroups(3). Идентификатор группы также будет изменён на gid этого пользователя,
если это не переопределено параметром \fB\-g\fP. Обратите внимание, что при использовании с
.B \-r
slapd будет искать базу данных пользователей в окружении изменённой корневой директории.

Имейте ввиду, что на некоторых системах при запуске с правами непривилегированного
пользователя для механизмов манипуляции данными passwd будет предотвращён доступ
к зашифрованным паролям. Также имейте ввиду, что любые механизмы манипуляции данными
shell будут запускаться с правами указанного непривилегированного пользователя.
.TP
.BI \-g \ group
.B slapd
будет запущен с правами группы, указанной именем или идентификатором.
Обратите внимание, что при использовании с
.B \-r
slapd будет искать базу данных групп пользователей в окружении изменённой
корневой директории.
.TP
.BI \-c \ cookie
Данный параметр предоставляет куки для потребителя репликации syncrepl.
Куки представляет собой разделённый запятыми список пар \fIимя=значение\fP.
Поддерживаемые в настоящий момент поля syncrepl-куки -
.BR rid ,
.BR sid ,
и
.BR csn .
.B rid
идентифицирует процесс репликации на сервере-потребителе и используется для
нахождения в
.BR slapd.conf (5)
или
.BR slapd\-config (5)
спецификации syncrepl, имеющей в своём определении соответствующий идентификатор репликации.
Если в этом параметре используются какие-либо другие значения,
.B rid
также должен быть указан.
.BR sid\  -
это идентификатор сервера в конфигурации репликации с несколькими главными серверами (multi-master)
или репликации в режиме зеркала (mirror-mode).
.BR csn\  -
это порядковый номер изменения, полученный во время предыдущей синхронизации
и представляющий собой состояние содержимого потребительской реплики, которое
механизм syncrepl будет синхронизировать с текущим содержимым каталога поставщика.
В случае конфигурации репликации \fIс несколькими главными серверами\fP
или репликации \fIв режиме зеркала\fP
могут присутствовать несколько разделённых запятыми значений
.BR csn .
Для принудительной полной перезагрузки используйте только часть
.B rid
данного параметра.
.TP
.BI \-o \ option\fR[ = value\fR]
Данный параметр предоставляет универсальную возможность указывать опции без
необходимости выделения для них отдельной буквы.

Поддерживаются следующие опции:
.RS
.TP
.BR slp= { on \||\| off \||\| \fIslp-attrs\fP }
Когда в slapd вкомпилирована поддержка SLP, эта опция отвечает за её отключение (\fBoff\fP),
её включение путём регистрации на SLP DA без специфических атрибутов SLP (\fBon\fP),
или со специфическими атрибутами SLP
.IR slp-attrs ,
которые должны представлять из себя определение списка атрибутов SLP
в соответствии со стандартом SLP.

Например, с параметром \fB"slp=(tree=production),(server-type=OpenLDAP),(server\-version=2.4.15)"\fP
slapd регистрируется на SLP DA с тремя атрибутами SLP: tree, server-type и server-version
с приведёнными выше значениями.
Это позволяет сделать конкретный запрос к SLP DA на предмет серверов LDAP, содержащих дерево
.I production
в случае, если доступно несколько деревьев.
.RE
.SH ПРИМЕРЫ
Чтобы запустить
.I slapd
так, чтобы он произвёл ответвление, отсоединился от терминала и начал обслуживание
баз данных LDAP, определённых в конфигурационном файле по умолчанию, просто выполните:
.LP
.nf
.ft tt
	@LIBEXECDIR@/slapd
.ft
.fi
.LP
Чтобы запустить
.B slapd
с альтернативным конфигурационным файлом и включить вывод большого объёма
отладочной информации в стандартный поток ошибок, выполните:
.LP
.nf
.ft tt
	@LIBEXECDIR@/slapd \-f /var/tmp/slapd.conf \-d 255
.ft
.fi
.LP
Чтобы протестировать корректность конфигурационного файла, выполните:
.LP
.nf
.ft tt
	@LIBEXECDIR@/slapd \-Tt
.ft
.fi
.LP
.SH "СМОТРИТЕ ТАКЖЕ"
.BR ldap (3),
.BR slapd.conf (5),
.BR slapd\-config (5),
.BR slapd.access (5),
.BR slapacl (8),
.BR slapadd (8),
.BR slapauth (8),
.BR slapcat (8),
.BR slapdn (8),
.BR slapindex (8),
.BR slappasswd (8),
.BR slapschema (8),
.BR slaptest (8).
.LP
"Руководство администратора OpenLDAP" (http://www.OpenLDAP.org/doc/admin/, https://pro-ldap.ru/tr/admin24/).
.SH "ИЗВЕСТНЫЕ ОШИБКИ"
Смотрите http://www.openldap.org/its/ .
.SH "ПРИЗНАНИЕ ЗАСЛУГ"
.so ../Project
