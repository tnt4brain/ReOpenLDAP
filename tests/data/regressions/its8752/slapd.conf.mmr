# stand-alone slapd config -- for testing (with indexing)
## $ReOpenLDAP$
## Copyright 1998-2018 ReOpenLDAP AUTHORS: please see AUTHORS file.
## All rights reserved.
##
## This file is part of ReOpenLDAP.
##
## Redistribution and use in source and binary forms, with or without
## modification, are permitted only as authorized by the OpenLDAP
## Public License.
##
## A copy of this license is available in the file LICENSE in the
## top-level directory of the distribution or, alternatively, at
## <http://www.OpenLDAP.org/license.html>.

include		@SCHEMADIR@/core.schema
include		@SCHEMADIR@/cosine.schema
include		@SCHEMADIR@/inetorgperson.schema
include		@SCHEMADIR@/openldap.schema
include		@SCHEMADIR@/nis.schema
include		@DATADIR@/test.schema

#
pidfile		@TESTDIR@/slapd.@MMR@.pid
argsfile	@TESTDIR@/slapd.@MMR@.args

serverid	@MMR@
#be-type=mod#modulepath ../servers/slapd/back-@BACKEND@/:../servers/slapd/overlays
#be-type=mod#moduleload	back_@BACKEND@.la
#monitor=mod#modulepath ../servers/slapd/back-monitor/
#monitor=mod#moduleload back_monitor.la
#syncprov=mod#modulepath ../servers/slapd/overlays/
#syncprov=mod#moduleload syncprov.la
#accesslog=mod#modulepath ../servers/slapd/overlays/
#accesslog=mod#moduleload accesslog.la

database	config
rootpw		config

database        @BACKEND@
#be=mdb,dbnosync=yes#dbnosync
#be=bdb,dbnosync=yes#dbnosync
#be=hdb,dbnosync=yes#dbnosync
suffix          "dc=example,dc=com"
rootdn          "cn=Manager,dc=example,dc=com"
rootpw          secret
#~null~#directory	@TESTDIR@/srv@MMR@/db.1
#indexdb#index		objectClass	eq
#indexdb#index		cn,sn,uid	pres,eq,sub

syncrepl
    rid=001
    provider=MMC1
    bindmethod=simple
    binddn="cn=Manager,dc=example,dc=com"
    credentials=secret
    type=refreshAndPersist
    searchbase="dc=example,dc=com"
    filter="(objectclass=*)"
    scope=sub
    schemachecking=on
    retry="1 +"
    logbase="cn=log"
    logfilter="(&(objectClass=auditWriteObject)(reqResult=0))"
    syncdata=accesslog
    sizeLimit=unlimited
    timelimit=unlimited

syncrepl
    rid=002
    provider=MMC2
    bindmethod=simple
    binddn="cn=Manager,dc=example,dc=com"
    credentials=secret
    type=refreshAndPersist
    searchbase="dc=example,dc=com"
    filter="(objectclass=*)"
    scope=sub
    schemachecking=on
    retry="1 +"
    logbase="cn=log"
    logfilter="(&(objectClass=auditWriteObject)(reqResult=0))"
    syncdata=accesslog
    sizeLimit=unlimited
    timelimit=unlimited

syncrepl
    rid=003
    provider=MMC3
    bindmethod=simple
    binddn="cn=Manager,dc=example,dc=com"
    credentials=secret
    type=refreshAndPersist
    searchbase="dc=example,dc=com"
    filter="(objectclass=*)"
    scope=sub
    schemachecking=on
    retry="1 +"
    logbase="cn=log"
    logfilter="(&(objectClass=auditWriteObject)(reqResult=0))"
    syncdata=accesslog
    sizeLimit=unlimited
    timelimit=unlimited

syncrepl
    rid=004
    provider=MMC4
    bindmethod=simple
    binddn="cn=Manager,dc=example,dc=com"
    credentials=secret
    type=refreshAndPersist
    searchbase="dc=example,dc=com"
    filter="(objectclass=*)"
    scope=sub
    schemachecking=on
    retry="1 +"
    logbase="cn=log"
    logfilter="(&(objectClass=auditWriteObject)(reqResult=0))"
    syncdata=accesslog
    sizeLimit=unlimited
    timelimit=unlimited

mirrormode		TRUE

overlay syncprov
syncprov-sessionlog	100
syncprov-checkpoint	100 10

overlay accesslog
logdb			cn=log
logops			writes
logsuccess		TRUE
logpurge		00:02 00:01

database        @BACKEND@
#be=mdb,dbnosync=yes#dbnosync
#be=bdb,dbnosync=yes#dbnosync
#be=hdb,dbnosync=yes#dbnosync
suffix          "cn=log"
rootdn          "cn=Manager,dc=example,dc=com"
#~null~#directory	@TESTDIR@/srv@MMR@/db.2
#indexdb#index		objectClass	eq
#indexdb#index		entryCSN,entryUUID,reqEnd,reqResult,reqStart eq
#be=mdb#maxsize        @MAPSIZE@

overlay syncprov
syncprov-reloadhint true
syncprov-nopresent true

#monitor=enabled#database	monitor
